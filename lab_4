
// ConsoleApplication4.cpp : Этот файл содержит функцию "main". Здесь начинается и заканчивается выполнение программы.
//
using namespace std;
#include <iostream>
#include <vector>
#include <cmath>
#include <fstream>

double maxu = 0;
double pi = acos(-1);
vector<double> progon(int N, vector <double> a, vector <double>  b, vector <double> c, vector <double> f)
{
    vector <double> m(N + 1), p(N + 1), q(N + 1);
    p[0] = b[0] / a[0];
    q[0] = f[0] / a[0];

    for (int i = 1; i <= N; i++)
    {
        p[i] = b[i] / (a[i] - c[i] * p[i - 1]);
        q[i] = (f[i]+c[i]*q[i-1]) / (a[i] - c[i] * p[i - 1]);
    }

    m[N] = q[N];
    for (int i = N - 1; i >= 0; i--)
    {
        m[i] = p[i] * m[i + 1] + q[i];

    }

    return m;

}

double analitic(double x,double t)
{  
    return  (1 - exp(-pi * pi * t)) * sin(pi*x) / (pi * pi);
}

int main()
{
   
    //cout << pi<<endl;
    double koef_a = 1;
    double ax = 0;
    double bx = 1;
    const int N = 100;
    double eps = 0.001;

    double h = (bx - ax) / N;  //шаг по х
    double tay = 0.01;     // шах по времени

   
    vector <double> x(N+1),u(N+1),uold(N+1),du(N+1);
    vector <double> a(N + 1), b(N + 1), c(N + 1), f(N + 1);
    vector <double> umaxtit(1000);
   
    //заполнение массива х

    for (int i = 0; i <= N; i++)
    {
        x[i] = ax + i * h;
        uold[i] = 0;
        //cout << x[i]<<" " << uold[i] << endl;
    }

    int k = 0;
    double maxU = 1;

    //цикл по времени
    do {

        //задаем коэфиценты

        for (int i = 1; i < N; i++)
        {
            a[i] = 1 + 2 * koef_a * tay / (h * h);
            b[i] = koef_a * tay / (h * h);
            c[i] = koef_a * tay / (h * h);
            f[i] = uold[i]+tay*sin(pi*x[i]);
            //cout << uold[i]<<endl;
        }

        a[0] = 1;
        b[0] = 0;
        c[0] = 0;
        f[0] = 0;

        a[N] = 1;
        b[N] = 0;
        c[N] = 0;
        f[N] = 0;

        u = progon(N, a, b, c, f);

        //Разница du

        maxu = 0;
       
        for (int i = 0; i <= N; i++)
        {
            du[i] = abs(u[i] - uold[i]);
            maxu = max(maxu, du[i]);
        }
        umaxtit[k] = maxu;

        for (int i = 0; i <= N; i++) uold[i] = u[i];
        k++;
    }
    while (maxu > eps);

 
   
   

    //сравнение с точным

    vector<double> time(1000);
        for (int i = 0; i <= k; i++) time[i] = i * tay;

    cout << time[k] << endl;
    vector<double> u_exact(N + 1),diff_u(N+1);

    //ofstream fout("u.txt ");
     cout <<"x "<< "u"  << " u_exact"  << " diff"  << endl;
    for (int i = 0; i < N+1; i++)
    {
        u_exact[i] = analitic(x[i], time[k]);
        diff_u[i] = abs(u[i] - u_exact[i]);
        cout  <<x[i] <<" " << u[i] << " " << u_exact[i] << " " << diff_u[i] << endl;
      
    }

    //fout.close();
   // cout << analitic(1,1);
}
